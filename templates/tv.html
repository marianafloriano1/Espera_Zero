<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Pódio de Caixas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      height: 100vh;
      margin: 0;
      background: #f4f4f4;
    }

    .podio {
      display: flex;
      gap: 20px;
      align-items: flex-end;
    }

    .caixa {
      width: 100px;
      background: #4CAF50;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
      border-radius: 8px 8px 0 0;
      transition: height 0.5s, background 0.5s;
      padding-bottom: 10px;
    }

    .tempo {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .caixa.alto {
      background: #2196F3;
    }
  </style>
</head>
<body>
  <div class="podio">
    <div class="caixa" id="normal"><span class="tempo">--</span>Normal</div>
    <div class="caixa" id="preferencial"><span class="tempo">--</span>Pref.</div>
    <div class="caixa" id="rapido"><span class="tempo">--</span>Rápido</div>
    <div class="caixa" id="autoatendimento"><span class="tempo">--</span>Auto</div>
  </div>

  <script>
    async function atualizarPodio() {
      try {
        const resp = await fetch("/count");  
        const texto = await resp.text();

        // Pega o tempo total em minutos
        const match = texto.match(/Tempo total: (\d+) minutos/);
        if (!match) return;
        
        let minutos = parseInt(match[1]);

        // Simulação: dividir o tempo entre os caixas (você pode ajustar)
        const tempos = {
          normal: minutos,
          preferencial: Math.max(0, minutos - 5),
          rapido: Math.max(0, minutos - 10),
          autoatendimento: Math.max(0, minutos - 15)
        };

        for (let id in tempos) {
          let caixa = document.getElementById(id);
          let span = caixa.querySelector(".tempo");
          let tempo = tempos[id];

          // Exibir tempo
          if (tempo === 0) {
            span.textContent = "00:00";
          } else {
            let horas = Math.floor(tempo / 60);
            let resto = tempo % 60;
            span.textContent = `${horas}:${resto.toString().padStart(2,'0')}`;
          }

          // Ajustar altura do pódio
          if (tempo <= 5) {
            caixa.classList.add("alto");
            caixa.style.height = "250px";
          } else {
            caixa.classList.remove("alto");
            caixa.style.height = `${120 + tempo * 2}px`; // altura proporcional
          }
        }
      } catch (err) {
        console.error("Erro ao atualizar pódio:", err);
      }
    }

    setInterval(atualizarPodio, 2000);
    atualizarPodio();
  </script>
</body>
</html>
