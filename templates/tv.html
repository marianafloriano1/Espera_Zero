<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Pódio de Caixas</title>
      <link rel="stylesheet" href="{{ url_for('static', filename='css/estilotv.css') }}">

</head>
<body>
  <div class="podio">
    <div class="col">
      <div class="titulo"></div>
      <div class="tempo" id="tempo-normal">--</div>
      <div class="caixa" id="normal">
        <p class="texto">CAIXA</p>
        <H1 class="texto2">1</H1>
      </div>
    </div>

    <div class="col">
      <div class="titulo"></div>
      <div class="tempo" id="tempo-preferencial">--</div>
      <div class="caixa" id="preferencial"><img class="img2" src="{{ url_for('static', filename='img/c.png') }}" alt="Imagem"></div>
    </div>

    <div class="col">
      <div class="titulo"></div>
      <div class="tempo" id="tempo-rapido">--</div>
      <div class="caixa" id="rapido"><img class="img2" src="{{ url_for('static', filename='img/r.png') }}" alt="Imagem"></div>
    </div>

    <div class="col">
      <div class="titulo"></div>
      <div class="tempo" id="tempo-autoatendimento">--</div>
      <div class="caixa" id="autoatendimento"><img class="img2" src="{{ url_for('static', filename='img/a.png') }}" alt="Imagem"></div>
    </div>
  </div>

  <script>
    async function atualizarPodio() {
  try {
    const resp = await fetch("/count");
    const texto = await resp.text();

    const match = texto.match(/Tempo total: (\d+) minutos/);
    if (!match) return;
    let minutos = parseInt(match[1]);

    const tempos = {
      normal: minutos,
      preferencial: Math.max(0, minutos - 5),
      rapido: Math.max(0, minutos - 10),
      autoatendimento: Math.max(0, minutos - 15)
    };

    // encontra o maior tempo
    const maiorTempo = Math.max(...Object.values(tempos));

    for (let id in tempos) {
      let caixa = document.getElementById(id);
      let tempoSpan = document.getElementById(`tempo-${id}`);
      let tempo = tempos[id];

      // formata tempo
      let displayTime;
      if (tempo === 0) {
        displayTime = "00:00";
      } else {
        let horas = Math.floor(tempo / 60);
        let resto = tempo % 60;
        displayTime = `${horas}:${resto.toString().padStart(2,'0')}`;
      }
      tempoSpan.textContent = displayTime;

      // pega a imagem do título
      let tituloImg = caixa.parentElement.querySelector(".titulo");

      // muda imagem do título conforme regra
      if (tempo === 0) {
        tituloImg.src = "{{ url_for('static', filename='img/livre.png') }}";
      } else if (tempo === maiorTempo) {
        tituloImg.src = "{{ url_for('static', filename='img/alerta.png') }}";
      } else {
        // volta para imagem padrão de cada caixa
        if (id === "normal") {
          tituloImg.src = "{{ url_for('static', filename='img/normal.png') }}";
        } else if (id === "preferencial") {
          tituloImg.src = "{{ url_for('static', filename='img/preferencial.png') }}";
        } else if (id === "rapido") {
          tituloImg.src = "{{ url_for('static', filename='img/rapido.png') }}";
        } else if (id === "autoatendimento") {
          tituloImg.src = "{{ url_for('static', filename='img/auto.png') }}";
        }
      }

      // ajusta altura do pódio
      if (tempo <= 5) {
        caixa.classList.add("alto");
        caixa.style.height = "400px";
      } else {
        caixa.classList.remove("alto");
        caixa.style.height = `${120 + tempo * 2}px`;
      }
    }
  } catch (err) {
    console.error("Erro ao atualizar pódio:", err);
  }
}

setInterval(atualizarPodio, 2000);
atualizarPodio();

  </script>
</body>
</html>
